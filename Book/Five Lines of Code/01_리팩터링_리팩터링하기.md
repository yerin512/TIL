
# 1장 리팩터링 리팩터링하기

리팩터링 리팩터링하기

높은 품질의 코드 - 유지 관리 비용 절감, 오류 줄이고, 개발자의 만족도를 향상 시킴. 리팩터링은 높은 품질의 코드를 얻는 가장 일반적인 방법임.

`코드 스멜(code smell) = 심오한 문제를 일으킬 가능성이 있는 프로그램 소스코드의 특징`

## 1.1 리팩터링이란 무엇인가?


가장 단순한 형태의 리팩터링은 '기능을 변겨앟지 않고 코드를 변경하는 것'을 의미함.


변경 전
```js
return pow(base, exp /2) * pow(base, exp / 2);
```

변경 후
```js
let result = pow(base, exp / 2);
return result * result;
```

위 예시는 계산식을 지역변수로 대체한다.

리팩터링을 해야하는 이유

- 코드를 더 빠르게 만들기 위해(앞의 예시)
- 더 작은 코드를 만들기 위해
- 코드를 더 일반적이거나 재사용 가능하게 하기 위해
- 코드의 가독성을 높이고 유지보수를 용이하게 하기 위해

좋은 코드 = 사람이 읽기 쉽고, 유지보수가 용이하며, 의도한 대로 잘 동작하는 코드.


## 1.2 스킬: 무엇을 리팩터링할 것인가?

코드 스멜과 이 책의 규칙 사이의 차이점에 대한 예를 알아본다.

### 1.2.1 코드 스멜의 예

'함수는 한 가지 작업을 수행해야 한다.'
잘 알려진 코드 스멜이지만 한 가지가 무엇인지 알기 쉽지 않다.

### 1.2.2 규칙의 예
이 책의 규칙은 '다섯 줄 제한'

## 1.3 문화: 리팩터링은 언제 할까?
대부분 레드-그린-리팩터 작업 절차를 제안하지만 이 접근법은 리팩터링을 테스트 주도 개발로 유도한다. 하지만 이 책에서는 이들을 분리하고 리팩터링 부분에 초점을 맞춘다. 6단계 작업 절차를 권장한다.

1. 탐색 : 항상 실험부터 시작하라. 무언가를 신속하게 구현하면 고객이 무엇을 필요로 하는지 함께 확인할 수 있다.

2. 명세화: 무엇을 만들지 알게 되면 그것을 명세화한다. 최적의 경우, 이것은 자동화된 테스트의 형태가 된다.

3. 구현: 코드를 구현한다.

4. 테스트: 코드가 2단계의 명세(사양)을 따르는지 확인한다.

5. 리팩터링: 코드를 전달하기 전에 다음 사람이 쉽게 작업할 수 있는지 확인한다.

6. 전달: 전달하는 방법에는 여러 가지가 있는데, 가장 일반적인 것은 pull  request 또는 특정 브랜치에 push하는 것이다.


### 1.3.1 레거시 시스템에서의 리팩터링

"우선 변경하기 쉽게 만든 후 변경하라."

새로운 것을 구현할 때마다 새 코드를 쉽게 추가할 수 있게 리팩터링을 먼저 한다.

### 1.3.2 언제 리팩터링을 하지 말아야 할까?

리팩터링은 정기적으로 하지 않을 경우 시간이 많이 걸릴 수 있다.
리팩터링이 필요하지 않은 세 가지 경우가 있다.

- 한 번 실행하고 삭제할 코드. 이것은 익스트림 프로그래밍 커뮤니티에서 스파이크로 알려진 것.
- 폐기되기 전 유지보수 모드에 있는 코드
- 임베디드 시스템이나 게임의 고급 물리엔진과 같이 엄격한 성능 요구사항이 있는 코드.

## 1.4 도구: (안전한)리팩터링 방법

소프트웨어 개발에서 자동화된 테스트는 자동차의 브레이크와 같다. 자동차가 느리게 갈 때는 존재감이 없지만 빨리 달릴 때는 브레이크가 있어 안전하다고 느낀다. 소프트웨어도 마찬가지다.

- 레시피처럼 상세하고 단계별로 구조화된 리팩터링 패턴
- 버전 관리(Git)
- 컴파일러

커밋을 수행해서 나중에 애플리케이션이 손상되었는데 수정을 어떻게 해야할지 모르면 간단히 돌아갈 수 있게 하라.
IDE를 통해 수동으로 테스트하거나 작은 단계로 수행하거나 다른 도움을 받으면서 리팩터링을 수행하면 확신을 얻을 수 있을 것이다.



## 요약

- 리팩터링을 수행하려면 리팩터링 대상을 식별하는 스킬과 리팩터링 단계를 명시적으로 가진 문화, 리팩터링을 돕는 도구의 조합이 필요하다.
- 일반적으로 코드 스멜은 리팩터링 대상을 설명하는 데 사용된다. 이것들은 모호해서 주니어 프로그래머가 내면화 하기 어렵다. 이 책에서는 코드 스멜을 대체할 구체적인 규칙을 제공한다.
규칙에는 세 가지 추상화 수준이 있다. 매우 구체적인 이름, 예외 형태로 뉘앙스를 더하는 설명, 마지막으로 그것들ㅇ ㅣ나오게 된 스멜의 의도.
- 자동화된 테스트와 리팩터링을 별도로 학습하면 진입 장벽을 낮출 수 있다. 자동화된 테스트 대신 컴파일러, 버전 관리 및 수동 테스트를 사용한다.

